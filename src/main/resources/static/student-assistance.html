<!DOCTYPE html>
<html lang="en">

  <head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:100,200,300,400,500,600,700,800,900" rel="stylesheet">

    <title>EduWell - Education HTML5 Template</title>

    <!-- Bootstrap core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">


    <!-- Additional CSS Files -->
    <link rel="stylesheet" href="assets/css/fontawesome.css">
    <link rel="stylesheet" href="assets/css/templatemo-eduwell-style.css">
    <link rel="stylesheet" href="assets/css/owl.css">
    <link rel="stylesheet" href="assets/css/lightbox.css">
    <link rel="stylesheet" href="assets/css/programaEstudio.css">
    <link rel="stylesheet" href="fontello.css">
<!--

TemplateMo 573 EduWell

https://templatemo.com/tm-573-eduwell

-->
  </head>

<body>


  <!-- ***** Header Area Start ***** -->
  <header class="header-area header-sticky">
      <div class="container">
          <div class="row">
              <div class="col-12">
                <nav class="main-nav">
                  <!-- ***** Logo Start ***** -->
                  <a href="index.html" class="logo">
                      <img src="assets/images/logoSeñorCaridad.png" style="max-width: 50px; height: auto;" alt="EduWell Template">
                  </a>
                  <!-- ***** Logo End ***** -->
                  <!-- ***** Menu Start ***** -->
                  <ul class="nav">
                    <li><a href="index.html" class="active">Inicio</a></li>
                    <li><a href="index.html">Servicios</a></li>
                    <li><a href="index.html">Programas de estudio</a></li>
                    <li class="has-sub">
                        <a href="javascript:void(0)">Páginas</a>
                        <ul class="sub-menu">
                            <li><a href="about-us.html">Sobre Nosotros</a></li>
                            <li><a href="our-services.html">Nuestros Servicios</a></li>
                            <li><a href="contact-us.html">Contáctanos</a></li>
                        </ul>
                    </li>
              
                  </ul>      
                  <a class='menu-trigger'>
                      <span>Menu</span>
                  </a>
                  <!-- ***** Menu End ***** -->
                </nav>
              </div>
          </div>
      </div>
  </header>

  <section class="contact-us"  >
    <div class="center-wrapper" >
      <div class="row justify-content-center" >
        <div class="col-lg-4">
          <form id="contact" action="" method="post" >
            <div class="row">
              <div class="col-lg-12">
                <div class="section-heading">
                  
                  <h4 style="text-align:center;"><em id="nombrePrograma">ASISTENCIA ALUMNOS</em></h4>
                </div>
                
              </div>
              
              <div class="col-lg-12">
                <h4 style="text-align:center;"><em>Ingresa DNI</em></h4>
                <fieldset  style="margin-top: 30px;">
                  <input name="dni" id="dni" placeholder="Dni ">
                </fieldset>
              </div>
          
              <div id="mensaje" style="color: green; margin-top: 10px;"></div>
              <div class="d-flex justify-content-center mt-3" text-center>
                <fieldset>
                  <button type="submit" id="form-submit" class="main-gradient-button">Registrar</button>
                </fieldset>
              </div>
              <h4 style="margin-top: 50px; text-align:center;"><em>o</em></h4>
              <h4 style="margin-top: 50px; text-align:center;"><em>Escanea QR</em></h4>
              <div class="container" style="text-align:center;">
                
                
            
                <!-- Botón para abrir el lector -->
                <div id="qr-section"   class="d-flex justify-content-center mt-3" style="margin-top:20px;">
                  <button id="btnAbrirQR" type="button" style="
                      padding:12px 25px;
                      font-size:16px;
                      border:none;
                      border-radius:8px;
                      background-color:#007bff;
                      color:white;
                      cursor:pointer;">
                    📷 Escanear QR
                  </button>
                </div>
            
                <!-- Lector QR -->
                <div id="reader" style="
                    width:300px;
                    height:auto;
                    margin:30px auto;
                    display:none;
                    border:2px solid #ddd;
                    border-radius:10px;">
                </div>
            
                <!-- Resultado del escaneo -->
                <div id="resultado" style="margin-top:15px; font-size:18px; font-weight:bold; color:#333;">
                  <!-- Aquí se mostrará el texto del QR -->
                </div>
              </div>
              
              
              
            </div>
          </form>
        </div>
      
        <div class="col-lg-12">
          <p class="copyright">Copyright © 2025 
          <br>Creado por: <a rel="sponsored" target="_blank"> Alumnos de M(a). Wendy Salinas Rojas</a></p>
        </div>
      </div>
    </div>
  </section>
  <a href="https://wa.me/51984476594" class="btn-wsp" target="_blank">
    <i class="fa fa-whatsapp icono"></i>
  </a>
  <!-- Scripts -->
  <!-- Bootstrap core JavaScript -->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <script src="assets/js/isotope.min.js"></script>
    <script src="assets/js/owl-carousel.js"></script>
    <script src="assets/js/lightbox.js"></script>
    <script src="assets/js/tabs.js"></script>
    <script src="assets/js/video.js"></script>
    <script src="assets/js/slick-slider.js"></script>
    <script src="assets/js/custom.js"></script>
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>

    <script>
        //according to loftblog tut
        $('.nav li:first').addClass('active');

        var showSection = function showSection(section, isAnimate) {
          var
          direction = section.replace(/#/, ''),
          reqSection = $('.section').filter('[data-section="' + direction + '"]'),
          reqSectionPos = reqSection.offset().top - 0;

          if (isAnimate) {
            $('body, html').animate({
              scrollTop: reqSectionPos },
            800);
          } else {
            $('body, html').scrollTop(reqSectionPos);
          }

        };

        var checkSection = function checkSection() {
          $('.section').each(function () {
            var
            $this = $(this),
            topEdge = $this.offset().top - 80,
            bottomEdge = topEdge + $this.height(),
            wScroll = $(window).scrollTop();
            if (topEdge < wScroll && bottomEdge > wScroll) {
              var
              currentId = $this.data('section'),
              reqLink = $('a').filter('[href*=\\#' + currentId + ']');
              reqLink.closest('li').addClass('active').
              siblings().removeClass('active');
            }
          });
        };

        $('.main-menu, .responsive-menu, .scroll-to-section').on('click', 'a', function (e) {
          e.preventDefault();
          showSection($(this).attr('href'), true);
        });

        $(window).scroll(function () {
          checkSection();
        });
        
       // Llamando a la API de guardar asistencia
      document.getElementById("form-submit").addEventListener("click", async (event) => {
        event.preventDefault(); // Evita que el formulario recargue la página

        const data = {
          contenido: document.getElementById("dni").value
        };

        try {
          //const response = await fetch("http://localhost:8080/asistencia/guardar", {
          const response = await fetch("https://proyectocetpro-production.up.railway.app/asistencia/guardar", {
            method: "POST",
            headers: {
              "Content-Type": "application/json"
            },
            body: JSON.stringify(data)
          });

          const result = await response.json(); // 👈 lee la respuesta como JSON
          const mensajeEl = document.getElementById("mensaje");

          if (response.ok) {
            mensajeEl.innerText = result.mensaje || "✅ Registro exitoso";

            // Cambiar color según mensaje
            if (result.mensaje.includes("exitosamente")) {
              mensajeEl.style.color = "green";
            } else {
              mensajeEl.style.color = "orange";
            }

          } else {
            mensajeEl.innerText = result.mensaje || "❌ Error al registrar, complete los datos obligatorios";
            mensajeEl.style.color = "red";
          }

        } catch (error) {
          console.error("Error en la petición:", error);
          const mensajeEl = document.getElementById("mensaje");
          mensajeEl.innerText = "⚠️ No se pudo conectar con el servidor";
          mensajeEl.style.color = "red";
        }
      });
        // Lector QR
      document.getElementById("btnAbrirQR").addEventListener("click", function() {
        const readerDiv = document.getElementById("reader");
        readerDiv.style.display = "block";

        const html5QrCode = new Html5Qrcode("reader");

        const qrCodeSuccessCallback = (decodedText, decodedResult) => {
          document.getElementById("resultado").innerText = "QR detectado: " + decodedText;

          // Enviar al backend
          fetch("https://proyectocetpro-production.up.railway.app/asistencia/guardar", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Accept": "application/json"
        },
        body: JSON.stringify({ contenido: decodedText })
      })
      .then(async resp => {
        const text = await resp.text();
        if (!resp.ok) throw new Error(`Error ${resp.status}: ${text}`);
        alert("✅ " + text);
      })
      .catch(err => {
        console.error("Error al enviar al backend:", err);
        alert("❌ Falló el guardado: " + err.message);
      });


          // Detiene el escaneo después de leer
          html5QrCode.stop().then(() => {
            readerDiv.style.display = "none";
          }).catch(err => console.error("Error al detener cámara:", err));
        };

        const config = { fps: 10, qrbox: { width: 250, height: 250 } };

        Html5Qrcode.getCameras()
          .then(devices => {
            if (devices && devices.length > 0) {
              // Buscar cámara trasera
              let backCamera = devices.find(d =>
                d.label.toLowerCase().includes("back") ||
                d.label.toLowerCase().includes("rear")
              );

              // Si no encuentra una trasera, usa la última disponible
              const cameraId = backCamera ? backCamera.id : devices[devices.length - 1].id;

              // Inicia la cámara seleccionada
              html5QrCode
                .start(cameraId, config, qrCodeSuccessCallback)
                .catch(err => {
                  console.error("⚠️ Error al iniciar cámara:", err);
                  alert("No se pudo iniciar la cámara. Verifica los permisos o prueba en otro navegador.");
                  readerDiv.style.display = "none";
                });

            } else {
              alert("No se encontraron cámaras disponibles.");
            }
          })
          .catch(err => {
            console.error("Error al obtener cámaras:", err);
            alert("No se pudo acceder a las cámaras. Verifica permisos del navegador.");
          });
      });

    </script>

</body>
</html>